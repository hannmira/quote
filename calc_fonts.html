<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Font / Line-height Î≥¥Ï†ï Í≥ÑÏàò</title>
</head>
<body>

  <pre id="output"></pre>

  <script src="font.js"></script>
  <script>
    const BASE_FONT = 'Pretendard';
    const BASE_SIZE = 100;
    const SAMPLE_TEXT = 'Î£∞ÌôúÍ∞íÍ¥úÎêêÏåå';

    function measureGlyphHeight(fontFamily) {
      const canvas = document.createElement('canvas');
      const ctx = canvas.getContext('2d');
      ctx.font = `${BASE_SIZE}px ${fontFamily}`;

      // Ïó¨Îü¨ Í∏ÄÏûêÎ•º ÌèâÍ∑†
      let totalHeight = 0;

      for (const char of SAMPLE_TEXT) {
        const m = ctx.measureText(char);
        totalHeight += m.actualBoundingBoxAscent + m.actualBoundingBoxDescent;
      }

      const avgHeight = totalHeight / SAMPLE_TEXT.length;
      return avgHeight;
    }

    function measureGlyphArea(fontFamily) {
      const canvas = document.createElement('canvas');
      const ctx = canvas.getContext('2d');
      ctx.font = `${BASE_SIZE}px ${fontFamily}`;

      let totalArea = 0;

      for (const char of SAMPLE_TEXT) {
        const m = ctx.measureText(char);
        const height = m.actualBoundingBoxAscent + m.actualBoundingBoxDescent;
        const width = m.width; // m.actualBoundingBoxLeft + m.actualBoundingBoxRight;
        totalArea += height * width;
      }

      return totalArea / SAMPLE_TEXT.length;
    }

    function formatMap(constName, map, baseValue) {
      const lines = [`const ${constName} = {`];
      lines.push(`  ${BASE_FONT}: ${baseValue},`);
      for (const [font, value] of Object.entries(map)) {
        if (font === BASE_FONT) continue;
        lines.push(`  ${font}: ${value.toFixed(3)},`);
      }
      lines.push('};');
      return lines.join('\n');
    }

    async function loadFont(name, url) {
      const font = new FontFace(name, `url(${url})`);
      await font.load();
      document.fonts.add(font);
    }

    async function run() {
      for (const [name, url] of Object.entries(fontMap)) {
        await loadFont(name, url);
      }

      const baseHeight = measureGlyphHeight(BASE_FONT);
      const baseArea = measureGlyphArea(BASE_FONT);

      const fontScaleMap = {};
      const lineHeightScaleMap = {};

      fontScaleMap[BASE_FONT] = 1.0;
      lineHeightScaleMap[BASE_FONT] = 1.0;

      for (const name of Object.keys(fontMap)) {
        if (name === BASE_FONT) continue;

        const height = measureGlyphHeight(name);
        const area = measureGlyphArea(name);

        // üîπ font-size Î≥¥Ï†ï ‚Üí Î©¥Ï†Å Í∏∞Ï§Ä
        fontScaleMap[name] = Math.pow(baseArea / area, 0.5);

        // üîπ line-height Î≥¥Ï†ï ‚Üí ÏÑ∏Î°ú Í∏∞Ï§Ä
        lineHeightScaleMap[name] = height / baseHeight;
      }

      const output =
        formatMap('fontScaleMap', fontScaleMap, '1.0') + '\n\n' +
        formatMap('lineHeightScaleMap', lineHeightScaleMap, '1.0');

      document.getElementById('output').textContent = output;
    }

    run();
  </script>

</body>
</html>